# Japanese Song Learning App MVP - Technical Plan

## Brief Description
Implement an MVP for a Japanese song learning app that plays audio files with synchronized lyrics display showing Japanese, English, and romaji translations side-by-side. The app should visually highlight current lyrics similar to Spotify's lyrics feature, using timestamp-based synchronization with human-editable data files stored in a `/data` folder.

## Files and Functions to Create

### Data Layer
- `/data/songs/[song-id]/audio.mp3` - Audio file storage
- `/data/songs/[song-id]/lyrics.json` - Lyrics data with timestamp synchronization
- `/src/types/lyrics.ts` - TypeScript interfaces for lyrics data structure
- `/src/utils/lyricsParser.ts` - Parser for lyrics JSON format

### Core Components
- `/src/components/AudioPlayer.tsx` - Audio playback with precise timing control
- `/src/components/LyricsDisplay.tsx` - Synchronized lyrics display component
- `/src/components/LyricsLine.tsx` - Individual lyric line with highlighting
- `/src/hooks/useAudioSync.ts` - Custom hook for audio-lyrics synchronization
- `/src/App.tsx` - Main app component integrating audio and lyrics

## Data Structure Algorithm

### Lyrics JSON Format
```json
{
  "metadata": {
    "title": "Song Title",
    "artist": "Artist Name",
    "duration": 180000
  },
  "lyrics": [
    {
      "startTime": 5000,
      "endTime": 8000,
      "japanese": "日本語の歌詞",
      "romaji": "nihongo no kashi",
      "english": "Japanese lyrics"
    }
  ]
}
```

### Synchronization Algorithm
1. **Audio Time Tracking**: Use HTML5 audio `timeupdate` event to get current playback position in milliseconds
2. **Active Line Detection**: Binary search through lyrics array to find current line based on `startTime` <= currentTime < `endTime`
3. **Highlighting Logic**: Apply active CSS class to current lyric line, remove from previous line
4. **Auto-scroll**: Calculate scroll position to keep active line centered in viewport

## Component Architecture

### AudioPlayer Component
- Wraps HTML5 `<audio>` element with custom controls
- Exposes `currentTime` state via context or props
- Handles play/pause/seek functionality
- Emits time updates for lyrics synchronization

### LyricsDisplay Component
- Receives current audio time as prop
- Maps over lyrics array to render LyricsLine components
- Manages scroll position to follow active line
- Handles three-column layout (Japanese | Romaji | English)

### useAudioSync Hook
- Manages audio time state
- Implements binary search for finding active lyric line
- Returns current line index and timing information
- Handles edge cases (before first line, after last line)

## Implementation Phases

### Phase 1: Data Layer
- Define TypeScript interfaces for lyrics structure
- Create sample lyrics.json file for one Vaundy song
- Implement lyrics parser utility
- Set up data loading from `/data` folder

### Phase 2A: Audio System
- Implement AudioPlayer component with HTML5 audio
- Add play/pause controls and seek functionality
- Set up time tracking and state management
- Test audio loading from `/data/songs/[song-id]/audio.mp3`

### Phase 2B: Lyrics Display
- Create LyricsDisplay and LyricsLine components
- Implement three-column layout with responsive design
- Add highlighting CSS for active lines
- Implement auto-scroll functionality

### Phase 3: Integration
- Connect audio time to lyrics synchronization
- Implement useAudioSync hook with binary search
- Add smooth transitions and visual polish
- Test end-to-end playback with sample song

## Technical Requirements
- React with TypeScript for type safety
- CSS modules or styled-components for styling
- HTML5 Audio API for playback control
- Responsive design for mobile and desktop
- Human-editable JSON format for easy content updates


